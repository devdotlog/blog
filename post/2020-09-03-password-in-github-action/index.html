<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Github Action을 이용한 빌드 &amp; 실행에서 패스워드 숨기기 </title>
  <meta name="description" content="뭐라도 좀 적고, 써야 남지 않을까?">
  <meta name="naver-site-verification" content="bcf371eb4e5b9977f8fcc0116a87d622e88abb85" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Github Action을 이용한 빌드 &amp; 실행에서 패스워드 숨기기" />
<meta property="og:description" content="Github에는 Actions라는 기능이 있습니다. Travis CI 처럼 소스코드를 이용해서 build, test, deploy 등의 기능을 수행할 수 있는 서비스입니다.
Github Actions을 이용하면 hugo blog 빌드 &amp; 배포, cron을 이용한 반복적인 업무 자동화도 할 수 있습니다.
Github Actions을 이용해서 DB 데이터 업데이트하기 만약에 일주일에 한번씩 DB를 업데이트 해야하는 일이 있다고 가정합니다.
 사용하는 DB용 클라이언트를 실행 login/password로 로그인 업데이트 query를 수행하기 위한 데이터 확인 Query를 실행 잊지 않고 정해진 요일에 반복 수행  아마도 개발자는 위와 같은 단계를 반복적으로 수행하게 됩니다." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sh0seo.github.io/post/2020-09-03-password-in-github-action/" />
<meta property="article:published_time" content="2020-09-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-09-03T00:00:00+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Github Action을 이용한 빌드 &amp; 실행에서 패스워드 숨기기"/>
<meta name="twitter:description" content="Github에는 Actions라는 기능이 있습니다. Travis CI 처럼 소스코드를 이용해서 build, test, deploy 등의 기능을 수행할 수 있는 서비스입니다.
Github Actions을 이용하면 hugo blog 빌드 &amp; 배포, cron을 이용한 반복적인 업무 자동화도 할 수 있습니다.
Github Actions을 이용해서 DB 데이터 업데이트하기 만약에 일주일에 한번씩 DB를 업데이트 해야하는 일이 있다고 가정합니다.
 사용하는 DB용 클라이언트를 실행 login/password로 로그인 업데이트 query를 수행하기 위한 데이터 확인 Query를 실행 잊지 않고 정해진 요일에 반복 수행  아마도 개발자는 위와 같은 단계를 반복적으로 수행하게 됩니다."/>

  
  
  
  <link rel="stylesheet" href="https://sh0seo.github.io/css/style-white.css">
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://sh0seo.github.io/images/favicon.ico" />

  
</head>
<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="https://sh0seo.github.io/">
  
    <div id="logo" style="background-image: url(https://sh0seo.github.io/images/logo.png)"></div>
  
  <div id="title">
    <h1>my side projects</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/project/projects/">My Toy Projects</a></li>
       
        <li><a href="/">posts</a></li>
       
        <li><a href="/about/">about</a></li>
      
    </ul>
  </div>
</header>
  

    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="content" itemprop="articleBody">
  
    <p><img src="https://sh0seo.github.io/images/github-actions.png" alt=""></p>
<p>Github에는 Actions라는 기능이 있습니다. Travis CI 처럼 소스코드를 이용해서 build, test, deploy 등의 기능을 수행할 수 있는 서비스입니다.</p>
<p>Github Actions을 이용하면 hugo blog 빌드 &amp; 배포, cron을 이용한 반복적인 업무 자동화도 할 수 있습니다.</p>
<h2 id="github-actions을-이용해서-db-데이터-업데이트하기">Github Actions을 이용해서 DB 데이터 업데이트하기</h2>
<p>만약에 일주일에 한번씩 DB를 업데이트 해야하는 일이 있다고 가정합니다.</p>
<ol>
<li>사용하는 DB용 클라이언트를 실행</li>
<li>login/password로 로그인</li>
<li>업데이트 query를 수행하기 위한 데이터 확인</li>
<li>Query를 실행</li>
<li>잊지 않고 정해진 요일에 반복 수행</li>
</ol>
<p>아마도 개발자는 위와 같은 단계를 반복적으로 수행하게 됩니다. 잊지 않고 반복적으로 해야하는 것도 중요하지만 사람이 직접 수행하다보면 실수도 하기 마련입니다.</p>
<p>그렇다면 golang 과 Github Action을 이용하여 반복적인 업무를 수행하는 코드를 만들어 보도록 합시다. 동시에 DB 접속정보(id, password, ip)와 같이 민감한 정보는 Secret 기능을 이용하여 코드 상에서 보이지 않도록 해봅니다.</p>
<h2 id="postgresql-db의-특정-컬럼의-데이터를-업데이트-하는-golang-code">Postgresql DB의 특정 컬럼의 데이터를 업데이트 하는 golang code</h2>
<p>대상 DB는 Postgresql DB를 사용합니다. 다른 DB를 사용한다면 그에 맞는 패키지를 사용해야 합니다.</p>
<ul>
<li>MySQL: <a href="https://github.com/go-sql-driver/mysql">https://github.com/go-sql-driver/mysql</a></li>
<li>MSSQL: <a href="https://github.com/denisenkom/go-mssqldb">https://github.com/denisenkom/go-mssqldb</a></li>
<li>Oracle: <a href="https://github.com/rana/ora">https://github.com/rana/ora</a></li>
<li>Postgres: <a href="https://github.com/lib/pq">https://github.com/lib/pq</a></li>
<li>SQLite: <a href="https://github.com/mattn/go-sqlite3">https://github.com/mattn/go-sqlite3</a></li>
<li>DB2: <a href="https://bitbucket.org/phiggins/db2cli">https://bitbucket.org/phiggins/db2cli</a></li>
</ul>
<p>필요에 따라 ORM을 사용해도 되지만, simple한 query만 사용하기에 기본 패키지에 있는 database/sql를 사용합니다.
소스코드의 기능은 아래와 같습니다.</p>
<ol>
<li>환경변수에 등록된 정보를 읽어온다.</li>
<li>DB 접속 정보를 구성하여 접속한다.</li>
<li><code>SELECT 1</code> 테스트 query를 수행한다.</li>
<li>등록된 사용자인지 확인한다.</li>
<li>카드 번호를 hash 한 값을 DB에 업데이트 한다.</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;crypto/sha256&#34;</span>
	<span class="s">&#34;database/sql&#34;</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;os&#34;</span>
	<span class="s">&#34;time&#34;</span>

	<span class="nx">_</span> <span class="s">&#34;github.com/lib/pq&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;DCCafe User RFID Update&#34;</span><span class="p">)</span>

	<span class="c1">// input
</span><span class="c1"></span>	<span class="nx">name</span> <span class="o">:=</span> <span class="s">&#34;홍길동&#34;</span>
	<span class="c1">// input
</span><span class="c1"></span>	<span class="nx">cardNumber</span> <span class="o">:=</span> <span class="s">&#34;3255213734&#34;</span>

	<span class="nx">dbHost</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;DB_HOST&#34;</span><span class="p">)</span> <span class="c1">// 로컬에서 개발 시에는 환경변수 DB_HOST에 등록
</span><span class="c1"></span>	<span class="nx">dbPassword</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;DB_PW&#34;</span><span class="p">)</span> <span class="c1">// 로컬에서 개발 시에는 환경변수 DB_PW에 패스워드 등록
</span><span class="c1"></span>
	<span class="nx">conn</span> <span class="o">:=</span> <span class="s">&#34;user=dcadmin password=%s host=%s dbname=dcadmin sslmode=disable&#34;</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;[Error] user empty\n&#34;</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">cardNumber</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;[Error] Card Number empty\n&#34;</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">dbHost</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;[Error] Not find DB HOST\n&#34;</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">dbPassword</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;[Error] Not find DB Password\n&#34;</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">sql</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="s">&#34;postgres&#34;</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span> <span class="nx">dbPassword</span><span class="p">,</span> <span class="nx">dbHost</span><span class="p">))</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">defer</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>

	<span class="kd">var</span> <span class="nx">status</span> <span class="kt">int</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">QueryRow</span><span class="p">(</span><span class="s">&#34;SELECT 1&#34;</span><span class="p">).</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">status</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nx">status</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;SELECT 1 is not %d\n&#34;</span><span class="p">,</span> <span class="nx">status</span><span class="p">))</span>
	<span class="p">}</span>

	<span class="c1">// get User
</span><span class="c1"></span>	<span class="kd">var</span> <span class="nx">user</span> <span class="nx">Users</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">QueryRow</span><span class="p">(</span><span class="s">`SELECT email, rfid, company, index, name, leave, regdate, updatedate FROM users WHERE name = $1`</span><span class="p">,</span> <span class="nx">name</span><span class="p">).</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">user</span><span class="p">.</span><span class="nx">rfid</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">user</span><span class="p">.</span><span class="nx">company</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">user</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">user</span><span class="p">.</span><span class="nx">leave</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">user</span><span class="p">.</span><span class="nx">regdate</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">user</span><span class="p">.</span><span class="nx">updatedate</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;find user %s\n&#34;</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>

	<span class="nx">rfid</span> <span class="o">:=</span> <span class="nf">hash</span><span class="p">(</span><span class="nx">cardNumber</span><span class="p">)</span>

	<span class="nx">status</span> <span class="p">=</span> <span class="mi">0</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">QueryRow</span><span class="p">(</span><span class="s">`SELECT 1 FROM users WHERE rfid = $1`</span><span class="p">,</span> <span class="nx">rfid</span><span class="p">).</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">status</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;[Error] Exist Card Number:%s\n&#34;</span><span class="p">,</span> <span class="nx">cardNumber</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Get new RFID %s\n&#34;</span><span class="p">,</span> <span class="nx">rfid</span><span class="p">)</span>

	<span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Exec</span><span class="p">(</span><span class="s">`UPDATE users SET rfid = $1, updatedate = now() WHERE index = $2`</span><span class="p">,</span> <span class="nx">rfid</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">index</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Update User: %s, CardNumber: %s\n&#34;</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">cardNumber</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">hash</span><span class="p">(</span><span class="nx">cardNumber</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="nx">sum</span> <span class="o">:=</span> <span class="nx">sha256</span><span class="p">.</span><span class="nf">Sum256</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">cardNumber</span><span class="p">))</span>
	<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%x&#34;</span><span class="p">,</span> <span class="nx">sum</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Users DB
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Users</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">email</span>      <span class="kt">string</span> <span class="c1">// PK
</span><span class="c1"></span>	<span class="nx">rfid</span>       <span class="kt">string</span> <span class="c1">// PK
</span><span class="c1"></span>	<span class="nx">company</span>    <span class="kt">string</span>
	<span class="nx">index</span>      <span class="kt">int</span>
	<span class="nx">name</span>       <span class="kt">string</span>
	<span class="nx">leave</span>      <span class="kt">bool</span>
	<span class="nx">regdate</span>    <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
	<span class="nx">updatedate</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
<span class="p">}</span>
</code></pre></div><p>로컬에서 테스트하여 정상적으로 동작하는 소스코드는 gihub 프로젝트에 push 합니다.</p>
<h2 id="github-action에서-cron--build--execute-스크립트">Github Action에서 cron / build / execute 스크립트</h2>
<p>자동 실행을 위한 Github Action용 스크립트를 작성합니다.
Github Action을 사용하기 위해서는 아래의 위치에 yml로 작성한 스크립트가 필요합니다.</p>
<pre><code>github-프로젝트-root/.github/workflows/main.yml
</code></pre><p>스크립트는 수행 시점을 정의하는 <code>on</code>과 수행해야하는 것(환경구성, 소스코드 실행)을 정의하는 <code>job</code>로 구분됩니다.</p>
<p>아래와 같이 <code>on</code>을 정의하면 두가지 조건을 설정할 수 있습니다.</p>
<ul>
<li><code>master</code> 브런치에 push가 되면 스크립트를 실행</li>
<li>일요일 0시에 스크립트를 실행</li>
</ul>
<pre><code>on:
  push:
    branches: [ master ]
  schedule:
    - cron:  '0 9 * * SUN'
</code></pre><p>그리고 Github Action 스크립트는 소스코드와 달리 github site에서 직접 수정하는 것이 도움이 됩니다. github site의 에디터에서 직접 수정을 하면 cron의 경우 아래와 같이 시간에 대한 정보를 확인할 수 있습니다.</p>
<p><img src="https://sh0seo.github.io/img/cron-preview.png" alt=""></p>
<p>전체 스크립트는 아래와 같습니다.</p>
<div class="highlight"><pre class="chroma"><code class="language-yml" data-lang="yml"><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">update</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="l">master ]</span><span class="w">
</span><span class="w">  </span><span class="nt">schedule</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">cron</span><span class="p">:</span><span class="w">  </span><span class="s1">&#39;0 9 * * SUN&#39;</span><span class="w">
</span><span class="w">      
</span><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v2.3.2</span><span class="w">
</span><span class="w">      </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;master&#34;</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">go setup</span><span class="w">
</span><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/setup-go@v2.1.2</span><span class="w">
</span><span class="w">      </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">go-version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1.13&#34;</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">pg driver</span><span class="w">
</span><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">        </span><span class="w">        </span><span class="l">go get github.com/lib/pq</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">run </span><span class="w">
</span><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">        </span><span class="w">        </span><span class="l">go run main.go</span><span class="w">
</span><span class="w">      </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">DB_HOST</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.DB_HOST}}</span><span class="w">
</span><span class="w">        </span><span class="nt">DB_PW</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.DB_PW}}</span><span class="w">
</span></code></pre></div><h2 id="환경정보는-secrets에-저장">환경정보는 secrets에 저장</h2>
<p>소스코드를 실행하기 위해 필요한 DB 접속정보는 공개되면 안되기 때문에 환경설정에서 읽어서 처리하도록 합니다. Github Action에서 환경설정에 특정 값을 설정하기 위해서는 <code>env</code>에 설정을 합니다. 아래 스크립트의 의미는 secrets.DB_HOST에 설정된 값을 DB_HOST 환경변수에 저장하겠다는 의미입니다.</p>
<div class="highlight"><pre class="chroma"><code class="language-yml" data-lang="yml"><span class="w">      </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">DB_HOST</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.DB_HOST}}</span><span class="w">
</span><span class="w">        </span><span class="nt">DB_PW</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.DB_PW}}</span><span class="w">
</span></code></pre></div><p>그렇다면 <code>${{ secrets.XXXXX }}</code> 값은 어디에서 설정하면 될까요? github의 해당 프로젝트의 setting 에서 관리할 수 있습니다.</p>
<p><img src="https://sh0seo.github.io/img/secrets-value.png" alt=""></p>
<h2 id="결론">결론</h2>
<p>Github Action 기능을 이용하여 golang 소스코드를 실행하는 기능을 만들었습니다. Travis CI에서 처리했던것 보다는 좀 더 github 친화적이라서 사용하기도 편하고, 특별한 서버 없이도 수행할 수 있는 장점이 있습니다. 저 같은 경우는 cron 기능, DB 업데이트 등을 모두 golang + github action으로 처리하고 있습니다. 좋은 기능은 역시 자주 사용해서 잊어먹지 않아야하고 이렇게 공유해야 합니다. ^^;</p>
<h2 id="참조">참조</h2>
<ul>
<li><a href="http://golang.site/go/article/106-SQL-DB-%ED%99%9C%EC%9A%A9">Golang DB Package</a></li>
<li><a href="https://pkg.go.dev/database/sql?tab=doc">Golang sql</a></li>
<li><a href="https://docs.github.com/en/actions">Github Action</a></li>
</ul>

  
  </div>
</article>


    <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2020  my side projects 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/project/projects/">My Toy Projects</a></li>
         
        <li><a href="/">posts</a></li>
         
        <li><a href="/about/">about</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
  
    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-156450601-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
  
</body>

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/js/main.js"></script>
</html>
